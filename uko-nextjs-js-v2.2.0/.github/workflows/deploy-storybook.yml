name: Deploy Storybook to GitHub Pages

on:
  # main ë¸Œëžœì¹˜ì— í‘¸ì‹œë  ë•Œë§ˆë‹¤ ì‹¤í–‰
  push:
    branches: [ main ]
    paths:
      - 'uko-nextjs-js-v2.2.0/**'
      - 'tokens.json'
  
  # ìˆ˜ë™ìœ¼ë¡œ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:

# GitHub Pages ë°°í¬ ê¶Œí•œ ì„¤ì •
permissions:
  contents: read
  pages: write
  id-token: write

# ë™ì‹œ ì‹¤í–‰ ì œí•œ (í•˜ë‚˜ì˜ ë°°í¬ë§Œ ì‹¤í–‰)
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    defaults:
      run:
        working-directory: ./uko-nextjs-js-v2.2.0
    
    steps:
    - name: ðŸ›’ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: ðŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: ./uko-nextjs-js-v2.2.0/package-lock.json
    
    - name: ðŸ“¦ Install Dependencies
      run: |
        npm ci --legacy-peer-deps || npm install --legacy-peer-deps
    
    - name: ðŸŽ¨ Sync Figma Design Tokens
      run: |
        echo "ðŸ”„ Figma ë””ìžì¸ í† í°ì„ ë™ê¸°í™”í•©ë‹ˆë‹¤..."
        npm run sync-figma-tokens
    
    - name: ðŸ“ Generate Component Stories
      run: |
        echo "ðŸ“š ì»´í¬ë„ŒíŠ¸ ìŠ¤í† ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤..."
        npm run generate-stories
    
    - name: ðŸ—ï¸ Build Storybook
      run: |
        echo "ðŸ”¨ Storybookì„ ë¹Œë“œí•©ë‹ˆë‹¤..."
        npm run build-storybook
      env:
        NODE_OPTIONS: --max_old_space_size=4096
    
    - name: ðŸ“‹ Prepare Deployment Files
      run: |
        echo "ðŸ“ ë°°í¬ íŒŒì¼ì„ ì¤€ë¹„í•©ë‹ˆë‹¤..."
        
        # .nojekyll íŒŒì¼ ìƒì„± (Jekyll ë¹„í™œì„±í™”)
        touch storybook-static/.nojekyll
        
        # README.md ìƒì„±
        cat > storybook-static/README.md << 'EOF'
        # UKO Design System Storybook
        
        ðŸŽ¨ **UKO ë””ìžì¸ ì‹œìŠ¤í…œì˜ ê³µì‹ Storybook ë¬¸ì„œìž…ë‹ˆë‹¤.**
        
        ## âœ¨ ì£¼ìš” ê¸°ëŠ¥
        
        - ðŸŽ¯ **Figma í† í° ìžë™ ë™ê¸°í™”**: ë””ìžì¸ í† í°ì´ ìžë™ìœ¼ë¡œ ë™ê¸°í™”ë©ë‹ˆë‹¤
        - ðŸš€ **ì»´í¬ë„ŒíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬**: 22ê°œì˜ ìž¬ì‚¬ìš© ê°€ëŠ¥í•œ React ì»´í¬ë„ŒíŠ¸
        - ðŸ“± **ë°˜ì‘í˜• ë””ìžì¸**: ë‹¤ì–‘í•œ ë””ë°”ì´ìŠ¤ì—ì„œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
        - ðŸ“– **ìžë™ ë¬¸ì„œí™”**: Propsì™€ ì‚¬ìš©ë²•ì´ ìžë™ìœ¼ë¡œ ë¬¸ì„œí™”ë©ë‹ˆë‹¤
        
        ## ðŸ”§ ê°œë°œ í™˜ê²½
        
        ```bash
        # ì „ì²´ ë””ìžì¸ ì‹œìŠ¤í…œ ì„¤ì • ë° ì‹¤í–‰
        npm run design-system:dev
        ```
        
        ## ðŸ“š ì¶”ê°€ ë¬¸ì„œ
        
        - [GitHub Repository](https://github.com/syseo0107/GitHub)
        - [ë¹ ë¥¸ ì‹œìž‘ ê°€ì´ë“œ](https://github.com/syseo0107/GitHub/blob/main/uko-nextjs-js-v2.2.0/QUICK_START.md)
        - [ìƒì„¸ ë¬¸ì„œ](https://github.com/syseo0107/GitHub/blob/main/uko-nextjs-js-v2.2.0/DESIGN_SYSTEM_README.md)
        
        ---
        
        **ë°°í¬ì¼**: $(date +%Y-%m-%d)  
        **ìžë™ ë°°í¬**: GitHub Actions
        EOF
        
        echo "âœ… ë°°í¬ íŒŒì¼ ì¤€ë¹„ ì™„ë£Œ"
    
    - name: ðŸš€ Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./uko-nextjs-js-v2.2.0/storybook-static
        destination_dir: .
        keep_files: false
        enable_jekyll: false
        commit_message: 'Deploy Storybook ${{ github.sha }}'
    
    - name: ðŸŽ‰ Deployment Success
      run: |
        echo "âœ… ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
        echo ""
        echo "ðŸŒ Storybook URL: https://syseo0107.github.io/GitHub/"
        echo ""
        echo "ðŸ“ ë°°í¬ ì •ë³´:"
        echo "  - ì»¤ë°‹: ${{ github.sha }}"
        echo "  - ë¸Œëžœì¹˜: ${{ github.ref_name }}"
        echo "  - ë°°í¬ ì‹œê°„: $(date)"
        echo ""
        echo "â±ï¸  GitHub Pages ì ìš©ê¹Œì§€ ëª‡ ë¶„ ì •ë„ ì†Œìš”ë  ìˆ˜ ìžˆìŠµë‹ˆë‹¤."